---
layout: post
title: The Twitter Virus
date: '2010-09-21T07:47:00.000-07:00'
author: Oatzy
tags:
- programming
- javascript
- worm
- exploit
- twitter
- tweets
- viruses
modified_time: '2010-09-21T16:01:44.882-07:00'
thumbnail: http://2.bp.blogspot.com/_p_IGrzjF6JY/TJi8BeQOocI/AAAAAAAAAWU/62zTd5jtqrc/s72-c/Moar-Twit-Virus.png
blogger_id: tag:blogger.com,1999:blog-14769935.post-1512711795451847852
blogger_orig_url: https://oatzy.blogspot.com/2010/09/twitter-virus.html
---

<b>Background </b><br /><br />So here's what's happened - Twitter has been '<a href="http://mashable.com/2010/09/21/twitter-mouseover-bug/">hacked</a>'. Now personally, I don't like such ambiguous use of the word hacked, since it tends to imply that some sort of infiltration or breaking in has taken place. But that's just me.<br /><br />No. What actually happened is that someone discovered that URLs can be posted that include JavaScript (and in particular the "<i>onMouseOver</i>" function), which was executed when you hovered over said link. Then the <i>Script Kiddies</i> got their hands on it, and all hell broke loose <br /><br />This is an example of '<i>code injection</i>' or '<a href="http://en.wikipedia.org/wiki/Cross_site_scripting"><i>cross-site scripting</i></a>'- that is, code can be posted to a website - be it by a comment, a status update or whatever - and the site will execute it as if it were part of the site's own code.<br /><br />For most sites, it's not possible, because comments, etc. are 'sanitised' so that code like this is removed or just displayed as plain-text, so it can't be executed. For example, on <a href="http://www.denofgeek.com/"><i>Den of Geek</i></a> they strip away all HTML tags from comments, which has the drawback of disallowing formatting, but gets the job done. But these things can slip through the net from time to time.<br /><br />One other recent example was <a href="http://arstechnica.com/tech-policy/news/2010/07/pranksters-have-a-field-day-with-youtube-injection-flaw.ars">on YouTube</a>. YouTube would normally validate it's code by stripping away the "&lt;script&gt;" tag which <i>should</i> have prevented the problem. Except, someone realised that if you start the comment with "&lt;script&gt;&lt;script&gt;", only the first tag is stripped away, so the code is still executed.<br /><br />And this was used to cause all sorts of havoc - redirecting people to porn sites, or adding banners and pop-ups to videos (mostly on Justin Bieber videos), and so on.<br /><br />In YouTube's case it took about an hour to spot the problem and two more to fix it (apparently). And apparently Twitter has been fixed now (approx. 2hours later). So kudos to them. <br /><br /><br /><b>The Code</b><br /><br />What's interesting about this is how involuntary activating it can be. All you have to do is hover over the link to execute it. Which, to be fair, is both simple and elegant (regardless of how inelegant the code itself looks).<br /><br />The general form looks like this:<br /><br /><blockquote><i>[some URL]/@"onmouseover="[some javascript]</i></blockquote><br />In it's simplest form, the code might be something like this (via <a href="http://www.sophos.com/blogs/gc/g/2010/09/21/twitter-onmouseover-security-flaw-widely-exploited/">Sophos.com</a>):<br /><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://www.sophos.com/images/blogs/gc/2010/09/onmouseover-popup.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="180" src="http://www.sophos.com/images/blogs/gc/2010/09/onmouseover-popup.jpg" width="320" /></a></div><br /><br />Which only uses the 'alert' function to create an annoying pop-up with some random message.<br /><br />As for code that will redirect you to some other site, I can't find an example, but one way of doing it might take the general form but add something like:<br /><blockquote><i>window.location.href = [redirect URL]</i></blockquote>Which is all very straight forward, very annoying and fairly boring. There's probably other havoc you can reek that will temporarily redesign a person's homepage, graffiti it, or whatever.<br /><br /><br /><b>The Virus</b><br /><br />Now these are personal favourites - the self-retweeting tweets. Literally a self-replicating Twitter status virus.<br /><br />Here's some example code:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/_p_IGrzjF6JY/TJi8BeQOocI/AAAAAAAAAWU/62zTd5jtqrc/s1600/Moar-Twit-Virus.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/_p_IGrzjF6JY/TJi8BeQOocI/AAAAAAAAAWU/62zTd5jtqrc/s320/Moar-Twit-Virus.png" /></a></div><br /><br />They both basically do the same thing, though the latter does it more elegantly.<br /><br />The first one finds the 'first text area' - i.e. the status input box - fills it with it's own URL - <i>this.innerHTML</i> - hits the update button for you - <i>('.status-update-form').submit()</i> - and then darkens the screen with <i>modal-overlay</i> which means that the page itself is unreachable (without reloading) and clicking anywhere reactivate the exploit.<br /><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/_p_IGrzjF6JY/TJi-w-64A1I/AAAAAAAAAWs/5qBLBV43gMg/s1600/overlay.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/_p_IGrzjF6JY/TJi-w-64A1I/AAAAAAAAAWs/5qBLBV43gMg/s320/overlay.jpg" /></a></div><br /><br />&nbsp;[Yeah, I wanted to see what it did :p]<br /><br /><br />For the second one, it gets the element with the tag Id="status". Here's a section of Twitter source code:<br /><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/_p_IGrzjF6JY/TJi9gyDqoAI/AAAAAAAAAWc/2ItJM8sIZtI/s1600/Source-Code.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="50" src="http://4.bp.blogspot.com/_p_IGrzjF6JY/TJi9gyDqoAI/AAAAAAAAAWc/2ItJM8sIZtI/s400/Source-Code.png" width="400" /></a></div><br /><br />So that would be the status input box as with the first example. It's just a nicer way of going about it, in my opinion. But anyway.<br /><br />And in this case, rather than just straight copying itself, it actually RTs the named user's last tweet (usually the code itself), which again is a nicer way of doing it. And it gives the original poster the credit they deserve (albeit with the potential risk of having their account suspended).<br /><br />Video of the exploit in action <a href="http://gizmodo.com/5643732/the-twitter-website-is-under-attack">here</a>. <br /><br />Another variant blacks out the actual status, like so:<br /><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/_p_IGrzjF6JY/TJi-UcFgIyI/AAAAAAAAAWk/7lPD5pMlgmg/s1600/Twit-Blackout.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/_p_IGrzjF6JY/TJi-UcFgIyI/AAAAAAAAAWk/7lPD5pMlgmg/s320/Twit-Blackout.png" /></a></div><br /><br />And what that means is (a) you don't know what's going on under there, and (b) your curiosity is more likely to get the better of you.<br /><br />The code is the same as the first of the above, except instead of the the <i>modal-overlay</i> you have <i>"style="color:#000;background:#000;</i> - basically, 'make the status black text on black background'.<br /><br /><br /><b>One Last Thing</b><br /><br />Obviously, the exploit wasn't limited to "onMouseOver". Any JavaScript could've been used (so long as it was 140 characters or less). But nonetheless, the code would need a trigger, and mouseover was one of the best ways of doing it. Others apparently managed to make it activate by moving the cursor anywhere on screen. So yeah.<br /><br />Personally I'd be interested to see how far this spread. And indeed, given the 'contagiousness' of it, it'd be quite useful for modelling how this - and indeed everything else - spread through Twitter (as I've <a href="http://oatzy.blogspot.com/2010/09/social-viruses.html">previously</a> <a href="http://oatzy.blogspot.com/2010/09/spread-through-network.html">talked about</a>).<br /><br />Again, a great part of this was the celebs and the connectors; including an early victim, Sarah Brown (Gordon's wife), who has over 1mil followers. And as I said, passing it on isn't as voluntary as RTing.<br /><br />Why should we have been worried? Imagine the blackout version of the above, but with an added redirect to some malicious site. Yeah. Not that that should be a problem anymore.<br /><br />I was going to say, if you want to have a play, learn a little JavaScript and have a go. But I guess you can't now. Shame.<br /><br />Wonder if anyone's tried XSS on Facebook yet...<br /><br /><br /><i><b>[Update]</b></i><br /><br />The exploit has definitely been <a href="http://twitter.com/delbius/status/25120366027">nullified</a>. Twitter explain what happened <a href="http://blog.twitter.com/2010/09/all-about-onmouseover-incident.html">here</a>.<br /><br />One of the <a href="http://twitter.com/zzap/status/25105107613">discoverers</a> of the exploit seems to be @<a href="http://twitter.com/zzap">Zzap</a> [<a href="http://news.netcraft.com/archives/2010/09/21/twitter-users-fall-victim-to-new-xss-worm.html">source</a>], who had no malicious intent for it. More curiosity. And he, himself, was inspired by the now suspended "RainbowTwtr" - screenshot of how they used it <a href="http://news.netcraft.com/wp-content/uploads/2010/09/web-rainbow.png">here</a>.<br /><br /><a href="http://www.securelist.com/en/blog/2297/Live_Twitter_XSS">This guy</a> from Kaspersky gives a brief analysis, including a graph of the exploit's growth over time (reaching 93 tweets per second at it's peak). <a href="http://threatpost.com/en_us/blogs/twitter-closes-web-hole-after-attack-hits-500000-092110">ThreatPost</a> also has some analysis.<br /><br />The exploitative tweets themselves don't seem to have been deleted by Twitter, but mouseover now does nothing (other than what a link is mean to do).<br /><br />Anyway. As you were..<br /><br /><br />Oatzy.<br /><br /><br />[I'll be honest, I'm not an expert of any sort on JavaScript. But I know enough to get by.]