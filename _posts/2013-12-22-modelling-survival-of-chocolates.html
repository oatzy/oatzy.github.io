---
layout: post
title: Modelling the Survival of Chocolates
date: '2013-12-22T12:16:00.001-08:00'
author: Oatzy
tags:
- simulation
- programming
- chocolate
- sociology
- analytical
- everyday maths
- problem solving
- maths
- modelling
modified_time: '2013-12-22T13:36:41.267-08:00'
thumbnail: http://4.bp.blogspot.com/-JVuhOJaGiaY/UrcR3Ak-b5I/AAAAAAAABH8/AhfXvDIKmtU/s72-c/paper-choc-plot.png
blogger_id: tag:blogger.com,1999:blog-14769935.post-478441352192107511
blogger_orig_url: https://oatzy.blogspot.com/2013/12/modelling-survival-of-chocolates.html
---

<br /><span style="font-family: Arial,Helvetica,sans-serif;">So it's been about a year since I last blogged. I've been kinda busy with university stuff, and growing my facial hair into something approaching a beard. I might write a blog about it at some point.</span><br /><br /><span style="font-family: Arial,Helvetica,sans-serif;">Anyway, I've got a little free time now - at least until after Christmas - so here we are. Let's waste some time...<br /><br /><br /><b>"This is a real paper, published in a proper journal"</b><br /><br />So the other day, my dad hands me this print out of an academic paper, "this seems like your sort of thing". The paper is called<br /><i><br />"The survival time of chocolates on hospital wards: covert observational study"</i> <span style="font-size: x-small;">[1]</span><br /><br />The basic set-up is this: staff at various hospitals put out boxes of Roses and Quality Street chocolates on wards, and (covertly) recorded every time one was taken. From this, they analysed the 'survival' of the chocolates, according to <a href="http://en.wikipedia.org/wiki/Kaplan-Meier_estimator">Kaplan-Meier</a> survival analysis. </span><br /><div class="separator" style="clear: both; text-align: center;"><span style="font-family: Arial,Helvetica,sans-serif;"><a href="http://4.bp.blogspot.com/-JVuhOJaGiaY/UrcR3Ak-b5I/AAAAAAAABH8/AhfXvDIKmtU/s1600/paper-choc-plot.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-JVuhOJaGiaY/UrcR3Ak-b5I/AAAAAAAABH8/AhfXvDIKmtU/s1600/paper-choc-plot.png" /></a></span></div><span style="font-family: Arial,Helvetica,sans-serif;">They found that the rate of chocolate consumption fit an exponential decay, with the median survival time for a chocolate being 51 minutes, and the survival half life ("time taken for 50% of the chocolates to be eaten") being 99 minutes. They also found that Roses chocolates were preferred over Quality Street.<br /><br /><br /><b>"Damn it, man, I'm a physicist, not a doctor!"</b><br />&nbsp;</span><br /><span style="font-family: Arial,Helvetica,sans-serif;">So I'm reading this paper, and I'm thinking "I reckon I could model this". So I had a crack at it. </span><br /><br /><span style="font-family: Arial,Helvetica,sans-serif;">Basically, what we've got here is an <a href="http://en.wikipedia.org/wiki/Agent_based_model">agent-based modelling</a> problem. Individuals encounter a box of chocolates at random intervals. Each box has a variety of different types of chocolates. So each individual will look through the box for any chocolate(s) they like the look of, and help themselves.<br /><br />We can make a few simplifications to this. First of all, we work in fixed, discrete time intervals. In each time interval, some number of people will encounter the box of chocolates - one person per interval in the simplest model, and some random number of people in a more complex model.<br /><br />Now, different people have different preferences. We could generate for each person a random set of preferences, but for simplicity we'll assume some 'average preference probability'. In other words, imagine there are equal numbers of each type of chocolates - what is the probability that any given person will pick type 1, type 2, etc. ?&nbsp;</span><br /><br /><span style="font-family: Arial,Helvetica,sans-serif;">So, in the model, each person will pick a random chocolate based on this preference probability distribution. This accounts for the fact that some types of chocolate (strawberry) are naturally more popular than others (toffee penny).<br /><br /><br /><b>Here's Where it Gets Maths-y</b><br /><br />We have a box of N chocolates total. There are m different types of chocolate, with each type i=1,..,m having a count of ni such that&nbsp;</span><br /><div style="text-align: center;"><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-9fiWOA5YSKs/UrcaCcDUcOI/AAAAAAAABIM/LQj7Uych-pQ/s1600/eqn1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-9fiWOA5YSKs/UrcaCcDUcOI/AAAAAAAABIM/LQj7Uych-pQ/s1600/eqn1.png" /></a></div></div><span style="font-family: Arial,Helvetica,sans-serif;">Each type also has a 'preference probability' pi with 0 &lt;= pi &lt;= 1 and </span><br /><div style="text-align: center;"><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-pq9Ds7VKaO0/UrcaKhfN6OI/AAAAAAAABIU/YDV_2VMJAFA/s1600/eqn2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-pq9Ds7VKaO0/UrcaKhfN6OI/AAAAAAAABIU/YDV_2VMJAFA/s1600/eqn2.png" /></a></div></div><span style="font-family: Arial,Helvetica,sans-serif;">In each time step dt an individual randomly chooses a type of chocolate, i in {1,...,m}, based on the preference distribution, and one chocolate of that type is removed from the box according to&nbsp;</span><br /><div style="text-align: center;"><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-ouTdpaQ5yxk/UrcaTctggMI/AAAAAAAABIc/sz_YJBIGN18/s1600/eqn3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-ouTdpaQ5yxk/UrcaTctggMI/AAAAAAAABIc/sz_YJBIGN18/s1600/eqn3.png" /></a></div></div><span style="font-family: Arial,Helvetica,sans-serif;">This process is repeated until N(t) = 0<br /><br />In the more complex model, some random number of individuals (following a Poisson distribution) each choose chocolates in each given time step. This is also functionally equivalent to a single individual choosing multiple chocolates in a single given time step.<br /><br /><br /><b>What Differential Does It Make?</b><br /><br />In the simplest model, one person chooses a single chocolate in each time step. This is nice, because it means we can express the model as a set of differential equations, which can be solved exactly. <br /><br />For each type of chocolate we have the rate of consumption given by</span><br /><div style="text-align: center;"><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-5oK44H6IyHQ/UrcaqV3NhgI/AAAAAAAABIk/qqvPde8wrv4/s1600/eqn4.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-5oK44H6IyHQ/UrcaqV3NhgI/AAAAAAAABIk/qqvPde8wrv4/s1600/eqn4.png" /></a></div></div><span style="font-family: Arial,Helvetica,sans-serif;">which has standard (exponential decay) solution</span><span style="font-family: Arial,Helvetica,sans-serif;">&nbsp;</span><br /><div style="text-align: center;"><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-wubkt4Iu58c/UrcaxOPkM0I/AAAAAAAABIs/UruW4Ijz7Cc/s1600/eqn5.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-wubkt4Iu58c/UrcaxOPkM0I/AAAAAAAABIs/UruW4Ijz7Cc/s1600/eqn5.png" /></a></div></div><span style="font-family: Arial,Helvetica,sans-serif;">And since the total count N is just the sum of the individual counts ni we get the full solution</span><br /><div style="text-align: center;"><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-__XKhG4_j5U/Urcbl-PpoVI/AAAAAAAABJE/-UxxR38IGjc/s1600/eqn6.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-__XKhG4_j5U/Urcbl-PpoVI/AAAAAAAABJE/-UxxR38IGjc/s1600/eqn6.png" /></a></div></div><span style="font-family: Arial,Helvetica,sans-serif;">In other words, it's just the sum of several exponential decays (with different decay rates) - making it, roughly, an exponential decay itself.&nbsp;</span><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-nmzOZfYSryk/UrcO_gvlFOI/AAAAAAAABHo/DJ3mDfx9Frg/s1600/chocolate-diff.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-nmzOZfYSryk/UrcO_gvlFOI/AAAAAAAABHo/DJ3mDfx9Frg/s1600/chocolate-diff.png" /></a></div><span style="font-family: Arial,Helvetica,sans-serif;">In particular, in the special case where all the chocolates are equally preferred such that pi = p for all i=1,..,m we get the solution</span><br /><div style="text-align: center;"><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-aZFWDDNBl4g/Urcblqd3ewI/AAAAAAAABJA/eYIJnOQg4dA/s1600/eqn7.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-aZFWDDNBl4g/Urcblqd3ewI/AAAAAAAABJA/eYIJnOQg4dA/s1600/eqn7.png" /></a></div></div><span style="font-family: Arial,Helvetica,sans-serif;">And all that is loosely what was observed on the hospital wards.&nbsp;</span><br /><br /><span style="font-family: Arial,Helvetica,sans-serif;">But these 'exact' solutions don't capture some of the subtleties of the real life set-up. For example, the toffee pennies might be completely ignored until they are the only option left; whereas, the exact solution assumes that (fractions of) all of the types of chocolate are being taken all the time, just at different rates.</span><br /><span style="font-family: Arial,Helvetica,sans-serif;"></span><br /><span style="font-family: Arial,Helvetica,sans-serif;"></span><br /><b><span style="font-family: Arial,Helvetica,sans-serif;">"We did not seek ethical approval for this study..."</span></b><br /><br /><span style="font-family: Arial,Helvetica,sans-serif;">As an improvement on the analytical solution, we can create a computer simulated model, that captures more of the randomness of real life (code below). For the smplest model, the results look something like this</span><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-S2HSuU8Y5VU/UrcOvVYTvuI/AAAAAAAABHg/Gcl0xcX8sP4/s1600/chocolate-sim.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-S2HSuU8Y5VU/UrcOvVYTvuI/AAAAAAAABHg/Gcl0xcX8sP4/s1600/chocolate-sim.png" /></a></div><span style="font-family: Arial,Helvetica,sans-serif;">Notice that in this version of the model, the number of chocolates decays more slowly, and has some of the granularity seen in the observed data plot.&nbsp;</span><br /><br /><span style="font-family: Arial,Helvetica,sans-serif;">Plus, the randomness means the specific behaviour varies from run to run - for example, the orange line decays relatively quickly, while the blue has a long stretch when nothing is being taken.</span><br /><br /><span style="font-family: Arial,Helvetica,sans-serif;">Interestingly, this model seems to have a linear decrease for the first ~20-30 time steps in every sample run. This is probably because, for those first few steps, everyone can get what they want. But eventually, certain types run out, and the rate of consumption decays away.<br /><br /><br /><span style="font-size: small;"><b>Why Do Chocoholics Come in Threes?</b></span></span><br /><br /><span style="font-family: Arial,Helvetica,sans-serif;">I wrote about the <a href="http://en.wikipedia.org/wiki/Poisson_distribution">Poisson distribution</a> before, back when I was <a href="http://oatzy.blogspot.co.uk/2011/01/model-cafe.html">modelling cafes</a>. Basically, while we might see an average of one person per time interval, we don't expect to see them so evenly spaced out. Rather, people will arrive in 'bursts' of varying size. This behaviour is described by the Poisson distribution.<br /><br />So I wrote my simulation in Python, using the <a href="http://www.numpy.org/">numpy</a> library for the Poisson distributed random numbers. The results look something like this</span><br /><div class="separator" style="clear: both; text-align: center;"><span style="font-family: Arial,Helvetica,sans-serif;"><a href="http://4.bp.blogspot.com/-KI-wkiE1LSM/UrcPHJcfAtI/AAAAAAAABH0/c1Ss813wLBI/s1600/chocolate-pois.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-KI-wkiE1LSM/UrcPHJcfAtI/AAAAAAAABH0/c1Ss813wLBI/s1600/chocolate-pois.png" /></a></span></div><span style="font-family: Arial,Helvetica,sans-serif;">In this case, the initial decrease is less linear than in the simple model, but the overall decay times are roughly the same (except for the blue line above). This is what we'd expect since, in the above, I chose the average number of people per interval to be 1.<br /><br />So yeah. <a href="https://dl.dropboxusercontent.com/u/4635169/chocolates.py">Try the code</a>, have a play with the parameters, see what happens. The output is the total number of chocolates remaining after each time step.</span><br /><span style="font-family: Arial,Helvetica,sans-serif;"><br /></span><span style="font-family: Arial,Helvetica,sans-serif;">One thing to look at would be how changing the probabilities affects the rate of decay - for example, does the number of chocolates decay faster when all the chocolates are equally popular, or when some are much more popular than others. I suspect the former is the case.</span><br /><br /><span style="font-family: Arial,Helvetica,sans-serif;">It might also be worth adding an option where a person can pick again if their prefered chocolate isn't avaiable. </span><br /><span style="font-family: Arial,Helvetica,sans-serif;"><br /><br /><b>And the IgNobel Prize for Medicine goes to...</b><br /><br />So that's that. And I can definitely see the original paper being nominated for an <a href="http://www.improbable.com/ig/">IgNobel</a>, at the very least.<br /><br />As for me, I have some <a href="http://oatzy.blogspot.co.uk/2011/12/gift-wrapping.html">gift wrapping</a> I really need to get to...<br /><br />Merry Christmas!<br /><br /><br /><i><b>Citation</b></i><br /><br />[1] P R Gajendragadkar, et al. <i>"The survival time of chocolates on hospital wards: covert observational study"</i> <a href="http://www.bmj.com/content/347/bmj.f7198">BMJ 2013;347:f7198</a> (Published 14 December 2013)<br /><br /><br />Oatzy.<br /><br /><br />[Next job, modelling Her Majesty's <a href="http://www.bbc.co.uk/news/uk-25344656">nuts</a>...]</span>