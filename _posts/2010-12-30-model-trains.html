---
layout: post
title: Model Trains
date: '2010-12-30T16:13:00.000-08:00'
author: Oatzy
tags:
- rush hour
- graph
- trains
- public transport
- maths
- modelling
- network
- pagerank
modified_time: '2010-12-30T16:13:54.577-08:00'
thumbnail: http://4.bp.blogspot.com/_p_IGrzjF6JY/TR0Y79krDEI/AAAAAAAAAbg/85ptN-J-Jpw/s72-c/pendolino.jpg
blogger_id: tag:blogger.com,1999:blog-14769935.post-1024945003950111067
blogger_orig_url: https://oatzy.blogspot.com/2010/12/model-trains.html
---

Continuing from the previous post on using <a href="http://oatzy.blogspot.com/2010/12/trainrank.html">PageRank</a> to rank stations by 'popularity', and with the help of <a href="http://gephi.org/">Gephi</a> - which makes it ridiculously easy to built network graphs and work PageRank out - I built the <a href="http://www.virgintrains.co.uk/routes-stations/">Virgin Pendolino</a> lines, and they look like this<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/_p_IGrzjF6JY/TR0Y79krDEI/AAAAAAAAAbg/85ptN-J-Jpw/s1600/pendolino.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://4.bp.blogspot.com/_p_IGrzjF6JY/TR0Y79krDEI/AAAAAAAAAbg/85ptN-J-Jpw/s320/pendolino.jpg" width="221" /></a></div>I then worked out PageRanks and picked a route I'm failiar with - the one that goes between Coventry and Birmingham New Street (the brown line).<br /><br /><br /><b>Old Model</b><br /><br />Going back to the equation I outlined in the <a href="http://oatzy.blogspot.com/2010/08/train-problem.html">first train post</a>, the number of passenger on the train at station <i>i</i> is modelled by<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/_p_IGrzjF6JY/THbs3gv-W3I/AAAAAAAAAMM/qdnlObXi1i0/s1600/Train-Eqn.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/_p_IGrzjF6JY/THbs3gv-W3I/AAAAAAAAAMM/qdnlObXi1i0/s1600/Train-Eqn.png" /></a></div>So now, we define<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/_p_IGrzjF6JY/TR0ZUti9ZyI/AAAAAAAAAbk/zDPtxePaKMA/s1600/T-eqn.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/_p_IGrzjF6JY/TR0ZUti9ZyI/AAAAAAAAAbk/zDPtxePaKMA/s1600/T-eqn.png" /></a></div>Where <i>P(i)</i> is the PageRank of station <i>i</i>, and <i>a</i> is some constant. We then work out 'passenger' numbers for each stop and get the graph below<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/_p_IGrzjF6JY/TR0Zcc1kWeI/AAAAAAAAAbo/CYArJtWxfA0/s1600/on-off-route.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="156" src="http://4.bp.blogspot.com/_p_IGrzjF6JY/TR0Zcc1kWeI/AAAAAAAAAbo/CYArJtWxfA0/s320/on-off-route.png" width="320" /></a></div>Here the blue line is number of people boarding, the orange line is people getting off and the yellow is total on board.<br /><br />And the interesting thing here is that while the on/off lines are quite squiggly, they seem to cancel each other out quite well leaving a fairly smooth curve for total passengers. Which you would kind of expect, since a popular station would have more people getting on AND getting off.<br /><br />So the question then was, how significant is the wiggliness that's left in the yellow curve.<br /><br /><br /><b>A Simpler Model</b><br /><br />For this, we imagine a train with the same number of stops (10) as above, but where <i>T(i,j)=1</i> for all stations <i>i,j</i> - i.e. there's only one person going between each pair of stops. And the nice thing about this is that the above monstrocity of an equation reduces to<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/_p_IGrzjF6JY/TR0ZkSbC_kI/AAAAAAAAAbs/3m0T455Jf6w/s1600/simple-eqn.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/_p_IGrzjF6JY/TR0ZkSbC_kI/AAAAAAAAAbs/3m0T455Jf6w/s1600/simple-eqn.png" /></a></div>where <i>i</i> is the current station's position on the route and <i>n</i> is the total number of stops.<br /><br />And if you multiply that by some constant to get a <a href="http://reference.wolfram.com/mathematica/ref/FindFit.html">best fit</a> and plot them together, you get this (orange is the fit)<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/_p_IGrzjF6JY/TR0Zt3AdJZI/AAAAAAAAAbw/vdEYFJYQ3b4/s1600/route-fit.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="160" src="http://1.bp.blogspot.com/_p_IGrzjF6JY/TR0Zt3AdJZI/AAAAAAAAAbw/vdEYFJYQ3b4/s320/route-fit.png" width="320" /></a></div>Which is a pretty damn good fit. Except for the first two stops. And what's weird about it is, you'd expect that the fact that there aren't any people getting off to cancel out the attenuation would mean the ideal curve would under-estimate. But it over estimates. I'm not sure how to explain it. But other than that..<br /><br /><br /><b>Decent Approximation</b><br /><br />And what the close fit suggests is that the 'popularity' of the station isn't as important a factor as how far along the route it is. Which, if true, simplifies the problem a massive amount.<br /><br />But that first station is still a problem, because that's an error or ~20%. And considering &lt;5% is usually considered the acceptable error limit, it's looking kind of bad.<br /><br />But you could argue that since it doesn't have a knock-on effect for the later stops, and because the passengers on-board after the first stop is countable on the platform, it's an acceptable 'problem'.<br /><br />Realistically, I should try the same for other routes to see if the same happens, or else find some real data to test it against. Because it could turn out I'm catastrophically wrong. Or I could turn out to be right. But for now, I'm content.<br /><br /><br /><b>Other Factors</b><br /><br />And that's that. So the only other thing that would affect passenger numbers on a per-station basis is <a href="http://oatzy.blogspot.com/2010/12/rush-hour.html">rush-hour effects</a>. This is significant over longer routes mainly, but it's significant bacause it affects the passengers getting on at a particular station differently to how it affects those getting off - this creates a disparity that doesn't cancel itself out like the above.<br /><br />But at the same time, thanks to the <a href="http://www.dft.gov.uk/pgr/statistics/">Department of Transport</a>, we do have numbers to work from for that. Then we just need to put together that model and multiply by some number - which can be found by counting, say, the number of people on the platform - and we hopefully have a pretty got estimation of whether or not you'll get a seat.<br /><br />And I'll finally be able to let go of this madeness. Fingers crossed!<br /><br /><br />Oatzy.